# Тестовое задание учета крипто-баланса пользователя

### Задание
**Цель**: Разработать модуль учета крипто-баланса пользователя, который позволяет корректно и безопасно: зачислять средства, списывать средства (выводы, платежи, комиссии)  
с учетом специфики блокчейна, асинхронности и рисков.  
Используйте Стек технологий PHP+Laravel.  
P.S. Не усложняйте задание, оно максимально простое, вам только необходимо описать зачисление и списание ЛК крипто-баланса пользователя, с учетом рисков.

## Пояснения
Основной акцент сделан на безопасность работы с балансами, предотвращение двойного списания и обработку ```PENDING```-транзакций.

### Безопасность и обработка рисков

##### Идемпотентность
Повторные запросы с одинаковым operationId (идемпотентный ключ) игнорируются для предотвращения двойного списания.

##### Параллельные транзакции
Используется DB::transaction() + lockForUpdate() для кошелька и транзакции.

##### PENDING-транзакции
Реализована система со статусами транзакций (```PENDING```, ```CONFIRMED```, ```FAILED```). Сначала транзакций помечается как ```PENDING```, после чего её должен обработать отдельный cron-worker.

##### Reserved-баланс

При выводе средств сумма резервируется (balance_reserved), основной баланс не уменьшается до подтверждения.

```PENDING```-транзакции не могут списать больше доступного баланса.
